#!/bin/sh
# pre-push: run check (detekt + ktlintCheck + test) before push

# ANSI colors (works in Git Bash, macOS, Linux)
RED='\033[0;31m'
GREEN='\033[0;32m'
YELLOW='\033[1;33m'
CYAN='\033[0;36m'
BOLD='\033[1m'
RESET='\033[0m'

echo ""
echo "${BOLD}━━━ Pre-push checks (02-backend/00-monolitic) ━━━${RESET}"
echo "  Running: detekt, ktlintCheck, test..."
echo ""

cd 02-backend/00-monolitic && ./gradlew check
result=$?

echo ""
if [ $result -eq 0 ]; then
  echo "${GREEN}✓ Checks passed. Good to push.${RESET}"
  echo ""
  exit 0
else
  echo "${RED}✗ Pre-push checks failed. Push was not performed.${RESET}"
  echo ""
  echo "${YELLOW}  위 로그에서 어떤 검사(detekt / ktlintCheck / test)에서 실패했는지 확인한 뒤, 아래를 참고해 수정하세요.${RESET}"
  echo ""
  echo "${CYAN}  • Kotlin 포맷(들여쓰기, import 순서 등) 오류인 경우:${RESET}"
  echo "    cd 02-backend/00-monolitic && ./gradlew ktlintFormat"
  echo "    → 자동 수정 후 변경 파일을 스테이징하고 다시 push 하세요."
  echo ""
  echo "${CYAN}  • Detekt(코드 스타일·복잡도 등) 오류인 경우:${RESET}"
  echo "    위 로그의 파일 경로와 규칙명을 보고 코드를 수정한 뒤,"
  echo "    cd 02-backend/00-monolitic && ./gradlew detekt"
  echo "    → 통과할 때까지 수정 후 다시 push 하세요."
  echo ""
  echo "${CYAN}  • 테스트 실패인 경우:${RESET}"
  echo "    위 로그에서 실패한 테스트 클래스·메서드를 확인한 뒤 코드를 수정하세요."
  echo "    단위 테스트만 실행: cd 02-backend/00-monolitic && ./gradlew unitTest"
  echo "    전체 테스트:       cd 02-backend/00-monolitic && ./gradlew test"
  echo "    → 통과할 때까지 수정 후 다시 push 하세요."
  echo ""
  echo "${YELLOW}  수정 후 다시 git push 하시면 됩니다.${RESET}"
  echo ""
  exit 1
fi
